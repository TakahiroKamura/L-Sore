# 実際のテスト手順

開発サーバーが `http://localhost:5173` で起動しています。

## 複数タブでテストする手順

### 1. ディーラー用タブを開く

ブラウザで以下のURLを開きます：

```
http://localhost:5173/?debug=true&userId=dealer1
```

- ユーザー名: `ディーラー太郎`（任意）
- 合言葉: `test1`
- 「ディーラーとして入室」をクリック

**ディーラー画面が表示される**
- 現在のフェーズ: **セッション開始前**
- 参加プレイヤー: 0名
- 「セッション開始（入室締め切り）」ボタンがグレーアウト（プレイヤーが1人以上必要）

### 2. プレイヤー1用タブを開く

**新しいタブ**で以下のURLを開きます：

```
http://localhost:5173/?debug=true&userId=player1
```

- ユーザー名: `プレイヤー1`（任意）
- 合言葉: `test1`
- 「プレイヤーとして入室」をクリック

**プレイヤー画面が表示される**
- 「ディーラーがセッションを開始するまでお待ちください」というメッセージ

**ディーラータブを確認**
- 参加プレイヤー: 1名
- 「セッション開始（入室締め切り）」ボタンが有効になる

### 3. プレイヤー2用タブを開く（オプション）

**さらに新しいタブ**で以下のURLを開きます：

```
http://localhost:5173/?debug=true&userId=player2
```

- ユーザー名: `プレイヤー2`（任意）
- 合言葉: `test1`
- 「プレイヤーとして入室」をクリック

**ディーラータブを確認**
- 参加プレイヤー: 2名

### 4. セッションを開始する

**ディーラータブで：**
1. プレイヤーが揃ったことを確認
2. 「**セッション開始（入室締め切り）**」ボタンをクリック
3. フェーズが「**待機中**」に変わる
4. 「お題を抽選」ボタンが表示される

**プレイヤータブで：**
- 「ディーラーがお題を出題するまでお待ちください」に変わる

### 5. ゲームを進行する

**ディーラータブで：**
1. 「お題を抽選」をクリック
2. 「回答受付開始」をクリック

**プレイヤータブで：**
3. お題が表示される
4. 回答を入力して「回答を送信」

**ディーラータブで：**
5. 全員の回答を確認
6. 「投票開始」をクリック

**プレイヤータブで：**
7. 他のプレイヤーの回答に投票

**ディーラータブで：**
8. 「結果発表」をクリック
9. 投票結果を確認
10. 「次のラウンド」で新しいラウンドへ
    - フェーズが「**セッション開始前**」に戻る
    - 新しいプレイヤーの入室を受け付けることができる

## ゲームフロー

```
1. セッション開始前（lobby）
   ↓ ディーラーが「セッション開始」
   
2. 待機中（waiting）
   ↓ ディーラーが「お題を抽選」
   
3. お題出題（topic_drawn）
   ↓ ディーラーが「回答受付開始」
   
4. 回答受付中（answering）
   ↓ プレイヤーが回答 → ディーラー

- URLに `?debug=true` が含まれているか確認
- ブラウザのアドレスバーで正しいURLになっているか確認
- ページをリロードしてみる

### 「セッション開始」ボタンが押せない場合

- プレイヤーが1人以上入室しているか確認
- プレイヤータブで正しく「プレイヤーとして入室」を選択したか確認

### リアルタイム同期が動作しない場合

- Supabaseの環境変数が正しく設定されているか確認（`.env`ファイル）
- SupabaseダッシュボードでRealtimeが有効になっているか確認
- ブラウザのコンソールでエラーが出ていないか確認

### 合言葉が正しくない場合

- Supabaseに初期データ（test1, test2, test3）が登録されているか確認
- `supabase/schema.sql`を実行したか確認
- 既存のデータベースがある場合は `supabase/migration_add_lobby.sql` を実行が「投票開始」
   
5. 投票中（voting）
   ↓ プレイヤーが投票 → ディーラーが「結果発表」
   
6. 結果表示（results）
   ↓ ディーラーが「次のラウンド」
   
→ 1. セッション開始前に戻る（ループ）
```

## リアルタイム同期の確認

- ディーラーがフェーズを進めると、プレイヤー画面も自動的に更新される
- プレイヤーが入室すると、ディーラー画面の参加者リストがリアルタイムで更新される
- プレイヤーが回答を送信すると、ディーラー画面にリアルタイムで表示される
- プレイヤーが投票すると、票数が即座に反映される

## デバッグ情報の確認

各タブで画面上部にデバッグ情報が表示されます：
- デバッグモードバッジ
- ユーザーID（各タブで異なる）
- 使用中のストレージ（sessionStorage）

## トラブルシューティング

### 同じユーザーIDになってしまう場合

- URLに `?debug=true` が含まれているか確認
- ブラウザのアドレスバーで正しいURLになっているか確認
- ページをリロードしてみる

### リアルタイム同期が動作しない場合

- Supabaseの環境変数が正しく設定されているか確認（`.env`ファイル）
- SupabaseダッシュボードでRealtimeが有効になっているか確認
- ブラウザのコンソールでエラーが出ていないか確認

### 合言葉が正しくない場合

- Supabaseに初期データ（test1, test2, test3）が登録されているか確認
- `supabase/schema.sql`を実行したか確認
