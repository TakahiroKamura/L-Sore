# お題ゲームメーカー（えるそれっ！～エルバニアではそれが正解～）

### ルール
- あなたとわたしは友人です。
- 回答は日本語で行ってください。
- アプリ内で絵文字を使わないでください。

### 概要
- お題ゲームメーカー（またの名を「えるそれっ！～エルバニアではそれが正解～」）は、ユーザーが自由にお題を作成し、友人や家族と一緒に楽しむことができるウェブアプリケーションです。
- ユーザーは様々なカテゴリーからお題を選び、自分だけのオリジナルお題を作成できます。

**追記**:
- 以前はただのお題メーカーでしたが、2026年2月12日より、Supabaseをバックエンドとし、出題されるお題大喜利で実際にブラウザで遊べるアプリケーションを目指してリニューアルします。

- 【廃止】PWA (Progressive Web App)として設計されており、オフラインでも利用可能です。これにより、インターネット接続が不安定な環境でもゲームを楽しむことができ、再配布も容易になります。
  - PWAとして提供する計画は注視になりました。

### 技術スタック
- HTML5, CSS3, JavaScript (ES6+)
- 【廃止】PWAで配布可能とする
- Supabaseをバックエンドとして使用

---
### Supabase運用方針

# プロジェクト指針：性善説ベースのリアルタイムゲーム開発

あなたはReact + TypeScript + Supabaseを用いた「認証不要のブラウザゲーム」の実装担当です。
以下のアーキテクチャルール（憲法）に絶対に従ってください。

## アーキテクチャルール
1. **NO AUTH:** Supabase Authは使用しない。ユーザーIDはユーザー名をそのまま使用する。
2. **ROOM BASED:** 全てのデータ（Players, Actions, GameState）は `room_id` に紐づく。
3. **REALTIME FIRST:** 状態管理はSupabaseのRealtime機能（`postgres_changes`）を使用し、DBの変更を即座にフロントエンドに反映させる。
4. **MINIMUM SECURITY:** RLSは「room_idが一致するか」のみチェックする。厳密な本人確認は不要。
5. **QUOTA PROTECTION:** ボタンの連打防止（Throttle）を実装し、無駄なリクエストで無料枠を消費しないようにする。
6. **NAME AS ID:** ユーザー名をそのままuser_idとして使用することで、同じ名前を使えば複数タブでも同じプレイヤーとして扱われる。

## 技術スタック
- Frontend: React, TypeScript, React-Bootstrap
- Backend: Supabase (Database, Realtime)
- Hosting: Cloudflare Pages (想定)

これより、指示に従いコードを生成してください。
---

### 主な機能

1. お題抽選機能： ユーザーが作成したお題リストからランダムにお題を抽選する機能。
2. メモ・備考機能：抽選されたお題に対して、ユーザーが自由にメモや備考を追加できる機能。
3. マックス抽選機能： ユーザーが設定した最大数までお題を抽選する機能。
4. 確率調整機能： お題の文字列を解析し、特定のルールに基づいて抽選確率を調整する機能。
5. コピー機能：抽選結果を特定のフォーマットでクリップボードにコピーする機能。

## お題フォーマット

- 各お題は以下のフォーマットで記述します。
1.
```
(1)から始まる(2)といえば？
```

2.
```
(3)なもの、(4)なこと
```

※お題のフォーマット単位でコピーします。

### コピーフォーマット
- 抽選結果を以下のフォーマットでコピーします。
- アプリのタイトル、配信のURL、ハッシュタグはフォームで設定可能にします。

```
【（アプリのタイトル）】お題「（お題）」を使ってゲーム中！　気になった人はこちら！（配信のURL） #ハッシュタグ
```

## リニューアル追加機能

1. 合言葉ログイン機能: ユーザーが合言葉を入力して特定のルームに参加できる機能。
2. ディーラー機能: ゲームの進行役を務めるユーザは、他のプレイヤーに対してお題を出題する役割を持つ。
3. プレイヤー機能: ディーラー以外のプレイヤーは、お題に回答・投票する役割だけを持つ。
4. プレイヤー管理機能: ルーム内のプレイヤー一覧を表示し、各プレイヤーのステータス（参加中、回答済みなど）を把握する機能（抽選とフェーズの締め切り）。

### 合言葉ログイン機能
- 完全な性善説で、合言葉の数だけルームを作れる機能は作らない。あらかじめ登録されている特定の数の部屋の名前を知っている人だけが参加できる仕組みにする。
- 合言葉はルームIDと同一視し、RLSでroom_idの一致を確認するだけに留める。

### ディーラー機能
- 「ディーラーとして入室」ボタンを押したユーザがディーラーになる。他の人が「ディーラーとして入室」ボタンを押してしまう可能性は、性善説で無視する。
- ディーラーはお題の抽選、ゲームの進行を担当する。既存の画面を大部分流用する。

### プレイヤー機能
- プレイヤーはお題の回答、投票のみを行う。お題の抽選やゲームの進行はできない。
- 画面の大部分を新規に作成する必要がある。

### 具体的なTODO
- ルームテーブルの設計と初期データ投入
- RLSポリシーの設定
- 合言葉ログイン画面の実装
- ルーム参加ロジックの実装
- 簡易ルーム画面と、ディーラー・プレイヤーとして入室する機能の実装
- PWAアプリとしての設定削除
- 知識不足で自宅サーバに「なるべく簡易に」ホスティングしていたのを、リッチにReactアプリ化する